jtype: Flow
with:
  port: 4091
  prefetch: 5
  protocol: grpc
executors:
  - name: YOLODetector
    uses: docker://jina-yolov5:1.0
    replicas: 3
    uses_with:
      weights_or_url: ${{ ENV.YOLO_WEIGHTS }}
      device: "0"
      image_size: 640
  - name: DeepSORT
    uses: docker://jina-tracker:1.0
    uses_with:
      embedder_kwargs:
        embedder: ${{ ENV.TRACKER_EMBEDDER }}
        embedder_model_name: ${{ ENV.TRACKER_EMBEDDER_MODEL_NAME }}
        embedder_model_version: ${{ ENV.TRACKER_EMBEDDER_MODEL_VERSION }}
        triton_url: ${{ ENV.TRACKER_TRITON_URL }}
  - name: Output
    uses: docker://jina-stream-output:1.0
    uses_with:
      address: ${{ ENV.OUTPUT_ADDRESS }}
      port: ${{ ENV.OUTPUT_PORT }}
      zmq: ${{ ENV.OUTPUT_USE_ZMQ }}